# Results


```{r include=FALSE}
# hectare_grid <- expand.grid(
#   north_south = 1:42,    # Numerical axis (1-42)
#   east_west = LETTERS[1:9]  # Roman letters (A-I)
# )
# 
# hectare_grid <- hectare_grid |>
#   mutate(
#     Hectare = paste0(east_west, north_south),  
#     lon = north_south,                        #
#     lat = match(east_west, LETTERS[1:9])     
#   )
# 
# squirrel_locations <- squirrel_data |>
#   filter(!is.na(Hectare)) |>  # Ensure we only use rows with Hectare information
#   mutate(
#     lon = as.numeric(substr(Hectare, 2, nchar(Hectare))),  
#     lat = match(substr(Hectare, 1, 1), LETTERS[1:9])      
#   )
# 
# ggplot() +
#   geom_tile(
#     data = hectare_grid,
#     aes(x = lon, y = lat, fill = "Grid"),
#     color = "black",
#     alpha = 0.1
#   ) +
#   # Add squirrel sightings as points
#   geom_point(
#     data = squirrel_locations,
#     aes(x = lon, y = lat, color = Primary.Fur.Color),
#     size = 2,
#     alpha = 0.7
#   ) +
#   scale_color_manual(values = c("gray" = "gray", "black" = "black", "cinnamon" = "brown")) +
#   labs(
#     title = "Squirrel Sightings by Hectare",
#     x = "Simulated Longitude",
#     y = "Simulated Latitude",
#     color = "Primary Fur Color"
#   ) +
#   theme_minimal() +
#   theme(legend.position = "bottom")
```

## Exploration of squirrels of different Primary Fur Color 
**General Questions**: How do black, cinnamon and standard gray morphs of Eastern Gray squirrels (Sciurus Carolinensis) differ in their spatial distributions and activity patterns in Central Park?


```{r, message=FALSE, warning=FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(tidyverse)
library(ggridges)
library(lubridate)
library(sf)
library(ggalluvial)
library(viridis)
library(scico)
library(forcats)

squirrel_data <- read.csv("./2018_Central_Park_Squirrel_Census_-_Squirrel_Data_20241120.csv")
squirrel_data <- squirrel_data |>
  mutate(across(everything(), ~ na_if(as.character(.), ""))) |>
  drop_na(Age, Location, Primary.Fur.Color) |>
  filter(Age != "?")
```

### What is the total number of sightings of black, cinnamon, and gray morphs of Eastern Gray squirrels within Central Park?


```{r}
ggplot(squirrel_data, aes(x = fct_infreq(Primary.Fur.Color), fill = Primary.Fur.Color)) +
  geom_bar() +
  labs(
    title = "Counts by Primary Fur Color",
    x = "Primary Fur Color",
    y = "Count of Squirrels"
  ) +
  theme(legend.position = "none") +
  theme_minimal() +
  scale_fill_manual(values = c('black', '#D2691E', 'grey'), guide = FALSE) 
```
### What is the spatial distribution of black, cinnamon, and gray morphs of Eastern Gray squirrels across Central Park?

```{r fig.width=10, fig.height=8}
coord_sf_obj <- squirrel_data |>
  st_as_sf(coords = c('X', 'Y'), crs = 4326) # crs=4326 refers to the "Coordinate Reference System" with EPSG code 4326. This ensures the coordinates are plot correctly.

ggplot() + 
    geom_sf(data = coord_sf_obj, aes(colour = squirrel_data$Primary.Fur.Color), 
            size = 1.5, shape = 1, alpha = .7) + 
    scale_colour_manual(values = c('black', '#D2691E', 'grey')) + 
    theme_minimal()  +
    labs(title = 'Squirrel Sighting Locations by Color')
```

### How do sighted behaviors differ among black, cinnamon, and gray morphs of Eastern Gray squirrels in Central Park?

```{r}
library(scales)

# assuming squirrel_data has columns like Primary.Fur.Color, Running, Chasing, Climbing, Eating, Foraging 
proportion_data <- squirrel_data |>
  pivot_longer(
    cols = c(Running, Chasing, Climbing, Eating, Foraging), 
    names_to = "Behavior",
    values_to = "Observed"
  ) |>
  filter(Observed == "true") |>
  # Count number of squirrels per Behavior & Primary.Fur.Color
  group_by(Primary.Fur.Color, Behavior) |>
  summarize(Count = n(), .groups = "drop")

# stacked proportion bar chart
ggplot(proportion_data, aes(x = Primary.Fur.Color, y = Count, fill = Behavior)) +
  geom_col(position = "fill", color = "black") +
  scale_y_continuous(labels = percent_format()) +
  labs(
    title = "Proportion of Behaviors by Primary Fur Color",
    x = "Primary Fur Color",
    y = "Proportion of Squirrels",
    fill = "Behavior"
  ) +
  theme_minimal() +
  scale_fill_brewer(palette = "Set3")

```

## What are the overall Eastern Gray squirrels’ spatiotemporal distributions and activity patterns in Central Park?



### What is the spatial concentration of Eastern Gray squirrel sightings within Central Park?


```{r}
# Convert to sf object first
coord_sf_obj <- squirrel_data |> 
  st_as_sf(coords = c('X', 'Y'), crs = 4326)

# Extract coordinates for density calculation
coords <- st_coordinates(coord_sf_obj)

# Create the plot
ggplot() +
  # Add filled contours with transparency
  stat_density_2d(data = as.data.frame(coords),
                 aes(X, Y, color = after_stat(level)),
                 geom = "density_2d") +
  theme_minimal() +
  labs(title = 'Squirrel Density Contours by Location',
       x = 'Longitude',
       y = 'Latitude') +
  # Adjust aspect ratio for better geographic representation
  coord_fixed()
```

### How does the frequency of Eastern Gray squirrel sightings vary across different times of day, different dates, and weather conditions in Central Park?

```{r}
# convert the Date column to proper date format
squirrel_data <- squirrel_data |>
  mutate(
    Date = as.Date(Date, format = "%m%d%Y"),
    # make shift a factor with PM first so AM appears on top
    Shift = factor(Shift, levels = c("PM", "AM"))
  )

# ridgeline plot
ggplot(squirrel_data, aes(x = Date, y = Shift, fill = Shift)) +
  geom_density_ridges(
    alpha = 0.6,
    scale = 0.9,
    rel_min_height = 0.01
  ) +
  scale_fill_manual(
    values = c("AM" = "#FDB462", "PM" = "#80B1D3")
  ) +
  scale_x_date(
    # Show every date on x-axis
    date_breaks = "1 day",
    date_labels = "%b %d",
    expand = c(0.01, 0) 
  ) +
  labs(
    title = "Distribution of Squirrel Sightings",
    subtitle = "By Time of Day",
    x = "Date",
    y = "Shift"
  ) +
  theme_ridges() +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  )
```

### How are Eastern Gray squirrel’s activity patterns affected by age and environmental features?


```{r}
behavior <- squirrel_data |>
  select(Age, Running, Chasing, Climbing, Eating, Foraging, Shift) |>
  pivot_longer(
    cols = c(Running, Chasing, Climbing, Eating, Foraging),
    names_to = "Behavior",
    values_to = "Observed"
  ) |>
  filter(Observed == "true") |>
  # Summarize counts per Age, Behavior, and Shift
  group_by(Age, Behavior, Shift) |>
  summarize(Count = n(), .groups = "drop") |>
  # Now group by Age and Shift to get the total count for that subset
  group_by(Age, Shift) |>
  mutate(Proportion = Count / sum(Count)) |>
  ungroup()

ggplot(behavior, aes(x = Behavior, y = Proportion, fill = Age)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Comparison of Behaviors by Age and Shift (Proportion)",
    x = "Behavior",
    y = "Proportion of Squirrels",
    fill = "Age Group"
  ) +
  facet_wrap(~Shift) +
  theme_minimal() +
  scale_y_continuous(labels = percent_format()) +
  scale_fill_brewer(palette = "Blues", direction = -1)

```



```{r}
behavior_data <- squirrel_data |>
  select(Age, Shift, Running, Chasing, Climbing, Eating, Foraging) |>
  pivot_longer(
    cols = c(Running, Chasing, Climbing, Eating, Foraging),
    names_to = "Behavior",
    values_to = "Observed"
  ) |>
  filter(Observed == "true") |>
  group_by(Shift, Age, Behavior) |>
  summarize(Count = n(), .groups = "drop")
```

```{r}
foraging_alluvial_data <- squirrel_data %>%
  filter(Foraging == "true") %>%
  group_by(Shift, Location) %>%
  summarize(Count = n(), .groups = "drop") %>%
  mutate(
    Shift = factor(Shift),
    Location = factor(Location)
  )

ggplot(foraging_alluvial_data,
       aes(axis1 = Shift, axis2 = Location, y = Count, fill = Location)) +
  geom_alluvium(color = "black") +
  geom_stratum() +
  geom_text(stat = "stratum", aes(label = after_stat(stratum)), size = 2) +
  scale_x_discrete(expand = c(0.1, 0.1)) +
  labs(
    title = "Foraging Patterns Across Shift and Location",
    x = "", 
    y = "Count"
  ) +
  theme_minimal()

```


```{r}
behavior_location <- squirrel_data |>
  select(Running, Chasing, Climbing, Eating, Foraging, Location) |>
  pivot_longer(
    cols = c(Running, Chasing, Climbing, Eating, Foraging),
    names_to = "Behavior",
    values_to = "Observed"
  ) |>
  filter(Observed == "true") |>
  group_by(Behavior, Location) |>
  summarize(Count = n(), .groups = "drop")  

mosaic_table <- xtabs(Count ~ Location + Behavior, data = behavior_location)

vcd::mosaic(
  ~ Behavior + Location,
  data = mosaic_table,
  direction = c("h", "v"),
  highlighting = "Behavior",
  highlighting_fill = scico(5, palette = "lajolla"), # Using the La Jolla palette
  shade = TRUE,
  legend = FALSE,
  main = "Mosaic of Behaviors by Location"
)
```

### How do Eastern Gray squirrels interact with humans when being sighted?

```{r fig.width= 10}
bubble_data <- squirrel_data |>
  select(X, Y, Eating, Foraging, Approaches, Runs.from) |>
  pivot_longer(
    cols = c(Eating, Foraging),
    names_to = "Behavior",
    values_to = "Observed_Behavior"
  ) |>
  pivot_longer(
    cols = c(Approaches, Runs.from),
    names_to = "Interaction",
    values_to = "Observed_Interaction"
  ) |>
  filter(Observed_Behavior == "true" & Observed_Interaction == "true") |>
  group_by(X, Y, Behavior, Interaction) |>
  summarize(Count = n(), .groups = "drop") |>
  st_as_sf(coords = c("X", "Y"), crs = 4326)

# Plotting using geom_sf
ggplot() +
  geom_sf(data = bubble_data, aes(color = Interaction), size = 3, shape = 1, alpha = 1) +
  facet_wrap(~Behavior) +
  labs(
    title = "Frequency of Human Interactions by Behavior and Location",
    size = "Interaction Count",
    color = "Behavior"
  ) +
  theme_minimal(base_size = 14) +
  scale_color_brewer(palette = "Set1")


```

```{r fig.height = 9, fig.width = 9}
sound_interaction <- squirrel_data |>
  select(Kuks, Quaas, Moans, Location, Approaches, Indifferent, Runs.from) |>
  pivot_longer(
    cols = c(Approaches, Indifferent, Runs.from),
    names_to = "Interaction",
    values_to = "Observed_Interaction"
  ) |>
  pivot_longer(
    cols = c(Kuks, Quaas, Moans),
    names_to = "Sound",
    values_to = "Sound_Value"
  ) |>
  filter(Sound_Value == "true", Observed_Interaction == "true") |>
  drop_na(Interaction, Sound) |>
  group_by(Location, Interaction, Sound) |>
  summarize(Freq = n(), .groups = "drop")

ggplot(sound_interaction,
       aes(axis1 = Location, axis2 = Sound, axis3 = Interaction, y = Freq, fill = Sound)) +
  geom_alluvium(color = "black") +
  geom_stratum() +
  geom_text(stat = "stratum", aes(label = after_stat(stratum))) +
  labs(
    title = "Transition of Human Interactions Across location and sound",
    x = "Categories",
    y = "Count of Observed Behaviors"
  ) +
  theme_minimal() +
  scale_fill_brewer(palette = "Set3")
```

```{r}
# coord_sf <- squirrel_data |>
#   st_as_sf(coords = c('X', 'Y'), crs = 4326) |>
#   pivot_longer(
#     cols = c(Running, Chasing, Climbing, Eating, Foraging), 
#     names_to = "Behavior",
#     values_to = "Observed"
#   ) |>
#   filter(Observed == "true") 
#   # No group_by needed if not summarizing
# 
# ggplot() + 
#   geom_sf(data = coord_sf, aes(color = Primary.Fur.Color), 
#           size = 1.5, shape = 1, alpha = 0.7) + 
#   scale_color_manual(values = c('black', '#D2691E', 'grey')) + 
#   facet_wrap(~ Behavior) +
#   theme_minimal() +
#   labs(title = 'Squirrel Sighting Locations by Color')

```