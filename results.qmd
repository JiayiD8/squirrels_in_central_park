# Results


```{r include=FALSE}
# hectare_grid <- expand.grid(
#   north_south = 1:42,    # Numerical axis (1-42)
#   east_west = LETTERS[1:9]  # Roman letters (A-I)
# )
# 
# hectare_grid <- hectare_grid |>
#   mutate(
#     Hectare = paste0(east_west, north_south),  
#     lon = north_south,                        #
#     lat = match(east_west, LETTERS[1:9])     
#   )
# 
# squirrel_locations <- squirrel_data |>
#   filter(!is.na(Hectare)) |>  # Ensure we only use rows with Hectare information
#   mutate(
#     lon = as.numeric(substr(Hectare, 2, nchar(Hectare))),  
#     lat = match(substr(Hectare, 1, 1), LETTERS[1:9])      
#   )
# 
# ggplot() +
#   geom_tile(
#     data = hectare_grid,
#     aes(x = lon, y = lat, fill = "Grid"),
#     color = "black",
#     alpha = 0.1
#   ) +
#   # Add squirrel sightings as points
#   geom_point(
#     data = squirrel_locations,
#     aes(x = lon, y = lat, color = Primary.Fur.Color),
#     size = 2,
#     alpha = 0.7
#   ) +
#   scale_color_manual(values = c("gray" = "gray", "black" = "black", "cinnamon" = "brown")) +
#   labs(
#     title = "Squirrel Sightings by Hectare",
#     x = "Simulated Longitude",
#     y = "Simulated Latitude",
#     color = "Primary Fur Color"
#   ) +
#   theme_minimal() +
#   theme(legend.position = "bottom")
```

## Exploration of squirrels of different Primary Fur Color 
**General Questions**: How do black, cinnamon and standard gray morphs of Eastern Gray squirrels (Sciurus Carolinensis) differ in their spatial distributions and activity patterns in Central Park?


```{r, message=FALSE, warning=FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(tidyverse)
library(ggridges)
library(lubridate)
library(sf)
library(ggalluvial)
library(viridis)
library(scico)
library(forcats)

squirrel_data <- read.csv("./2018_Central_Park_Squirrel_Census_-_Squirrel_Data_20241120.csv")
squirrel_data <- squirrel_data |>
  mutate(across(everything(), ~ na_if(as.character(.), ""))) |>
  drop_na(Age, Location, Primary.Fur.Color) |>
  filter(Age != "?")
```

### What is the total number of sightings of black, cinnamon, and gray morphs of Eastern Gray squirrels within Central Park?


```{r, message=FALSE, warning=FALSE}
ggplot(squirrel_data, aes(x = fct_infreq(Primary.Fur.Color), fill = Primary.Fur.Color)) +
  geom_bar() +
  labs(
    title = "Counts by Primary Fur Color",
    x = "Primary Fur Color",
    y = "Count of Squirrels"
  ) +
  theme(legend.position = "none") +
  theme_minimal() +
  scale_fill_manual(values = c('black', '#D2691E', 'grey'), guide = FALSE) 
```
The bar plot shows that Eastern Gray squirrels with gray fur are the most commonly sighted in Central Park, with over 2,000 observations. Cinnamon-colored squirrels are less common, with several hundred sightings, while black-colored squirrels are the rarest, with fewer than 500 sightings. This is reasonable since Eastern Gray squirrels are the most prevalent squirrels in the central park. 

### What is the spatial distribution of black, cinnamon, and gray morphs of Eastern Gray squirrels across Central Park?

```{r fig.width=10, fig.height=8}
coord_sf_obj <- squirrel_data |>
  st_as_sf(coords = c('X', 'Y'), crs = 4326) # crs=4326 refers to the "Coordinate Reference System" with EPSG code 4326. This ensures the coordinates are plot correctly.

ggplot() + 
    geom_sf(data = coord_sf_obj, aes(color = squirrel_data$Primary.Fur.Color), 
            size = 1.5, shape = 1, alpha = .7) + 
    scale_colour_manual(values = c('black', '#D2691E', 'grey')) + 
    theme_minimal()  +
    labs(title = 'Squirrel Sighting Locations by Color', 
         color = 'Primary Fur Color')
```

The map shows that Gray squirrels seem to donimate the central park. They are widespread and seen almost everywhere on the map. Cinnamon-colored squirrels are less common and appear more scattered on the lower side of the park. Black squirrels are the rarest, with only a few sightings concentrated in specific areas. Such data might because of the ways of data collection that there might only be several black squirrels and the data are clustered becuase different people sighted it around it's drey at different time.  

### How do sighted behaviors differ among black, cinnamon, and gray morphs of Eastern Gray squirrels in Central Park?

As the number of squirrels with different colors are largely imbalanced, we plot the stacked proportion bar plot to explore if sighted behaviors differ among black, cinnamon, and gray squirrels. 

```{r, message=FALSE, warning=FALSE}
# assuming squirrel_data has columns like Primary.Fur.Color, Running, Chasing, Climbing, Eating, Foraging 
proportion_data <- squirrel_data |>
  pivot_longer(
    cols = c(Running, Chasing, Climbing, Eating, Foraging), 
    names_to = "Behavior",
    values_to = "Observed"
  ) |>
  filter(Observed == "true") |>
  # Count number of squirrels per Behavior & Primary.Fur.Color
  group_by(Primary.Fur.Color, Behavior) |>
  summarize(Count = n(), .groups = "drop")

library(paletteer)

ggplot(proportion_data, aes(x = Primary.Fur.Color, y = Count, fill = Behavior)) +
  geom_col(position = "fill", color = "black") +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(
    title = "Proportion of Behaviors by Primary Fur Color",
    x = "Primary Fur Color",
    y = "Proportion of Squirrels",
    fill = "Behavior"
  ) +
  theme_minimal() +
  scale_fill_paletteer_d("ggthemes::Miller_Stone", direction = -1)
```
The plot shows that in Central Park appears uniform across fur colors, with foraging and running being the most frequent activities while squirrels are sighted. 


## What are the overall Eastern Gray squirrels’ spatiotemporal distributions and activity patterns in Central Park?

Since, we see no behavioral difference between across squirrels with different fur colors, we then explore the overall distribution of entire squirrel species. 

### What is the spatial concentration of Eastern Gray squirrel sightings within Central Park?


```{r}
# Extract coordinates from the point data
squirrel_coords <- squirrel_data |>
  mutate(
    coords = str_extract(Lat.Long, "\\(.*\\)"),
    coords = str_remove_all(coords, "[\\(\\)]"),
    longitude = as.numeric(word(coords, 1)),
    latitude = as.numeric(word(coords, 2))
  )

ggplot(squirrel_coords, aes(x = longitude, y = latitude)) +
  geom_hex(bins = 40) +
  scale_fill_distiller(palette = "Blues", direction = 1) +
    scale_x_continuous(
    labels = function(x) paste0(abs(x), "°W"),  
    breaks = seq(-74, -73.95, by = 0.01)        
  ) +
  scale_y_continuous(
    labels = function(y) paste0(y, "°N"),      
    breaks = seq(40.76, 40.8, by = 0.005)       
  ) +
  theme_minimal() +
  labs(
    title = "Squirrel Location Density",
    subtitle = "Hexagon binning visualization",
    x = "Longitude",
    y = "Latitude",
    fill = "Count"
  ) +
  coord_fixed()


```
From this plot, we can see that squirrels are spread throughout the central park, but they tend to cluster more heavily in certain areas. The darker-colored hexagons show spots where more sightings of squirrels are located, suggesting these places might be particularly attractive to them—maybe because of food sources, water, shelter, or other favorable conditions. To be specific, northern side of the Jacqueline Kennedy Onassis Reservoir, right next to the lake, and the lower right corner, are some of the "hotspot" for squirrels. 

### How does the frequency of Eastern Gray squirrel sightings vary across different times of day, different dates, and weather conditions in Central Park?

```{r}
# convert the Date column to proper date format
squirrel_data <- squirrel_data |>
  mutate(
    Date = as.Date(Date, format = "%m%d%Y"),
    # make shift a factor with PM first so AM appears on top
    Shift = factor(Shift, levels = c("PM", "AM"))
  )

# ridgeline plot
ggplot(squirrel_data, aes(x = Date, y = Shift, fill = Shift)) +
  geom_density_ridges(
    alpha = 0.6,
    scale = 0.9,
    rel_min_height = 0.01
  ) +
  scale_fill_manual(
    values = c("AM" = "#FDB462", "PM" = "#80B1D3")
  ) +
  scale_x_date(
    # Show every date on x-axis
    date_breaks = "1 day",
    date_labels = "%b %d",
    expand = c(0.01, 0) 
  ) +
  labs(
    title = "Distribution of Squirrel Sightings",
    subtitle = "By Time of Day",
    x = "Date",
    y = "Shift"
  ) +
  theme_ridges() +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  )
```
This plot shows the distribution of squirrel sightings across days in October, divided into morning (AM) and afternoon (PM) shifts. The overall sighting density are similar for morning and afternoon across October, except several days like Oct 07, 10, 13, and 14. This could becuase different weather condition across the day. For example, 


### How are Eastern Gray squirrel’s activity patterns affected by age and environmental features?


```{r}
library(scales)
behavior <- squirrel_data |>
  select(Age, Running, Chasing, Climbing, Eating, Foraging, Shift) |>
  pivot_longer(
    cols = c(Running, Chasing, Climbing, Eating, Foraging),
    names_to = "Behavior",
    values_to = "Observed"
  ) |>
  filter(Observed == "true") |>
  # Summarize counts per Age, Behavior, and Shift
  group_by(Age, Behavior, Shift) |>
  summarize(Count = n(), .groups = "drop") |>
  # Now group by Age and Shift to get the total count for that subset
  group_by(Age, Shift) |>
  mutate(Proportion = Count / sum(Count)) |>
  ungroup()

ggplot(behavior, aes(x = Behavior, y = Proportion, fill = Age)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Comparison of Behaviors by Age and Shift (Proportion)",
    x = "Behavior",
    y = "Proportion of Squirrels",
    fill = "Age Group"
  ) +
  facet_wrap(~Shift) +
  theme_minimal() +
  scale_y_continuous(labels = label_percent())+
  scale_fill_manual(
    values = c("Adult" = "#502419", "Juvenile" = "#7ea172")
  ) 

```

```{r}
foraging_alluvial_data <- squirrel_data |>
  filter(Foraging == "true") |>
  group_by(Shift, Location) |>
  summarize(Count = n(), .groups = "drop") |>
  mutate(
    Shift = factor(Shift),
    Location = factor(Location)
  )

ggplot(foraging_alluvial_data,
       aes(axis1 = Shift, axis2 = Location, y = Count, fill = Location)) +
  geom_alluvium(color = "black") +
  geom_stratum() +
  geom_text(stat = "stratum", aes(label = after_stat(stratum)), size = 2) +
  scale_x_discrete(expand = c(0.1, 0.1)) +
  labs(
    title = "Foraging Patterns Across Shift and Location",
    x = "", 
    y = "Count"
  ) +
  theme_minimal()

```


```{r}
behavior_location <- squirrel_data |>
  select(Running, Chasing, Climbing, Eating, Foraging, Location) |>
  pivot_longer(
    cols = c(Running, Chasing, Climbing, Eating, Foraging),
    names_to = "Behavior",
    values_to = "Observed"
  ) |>
  filter(Observed == "true") |>
  group_by(Behavior, Location) |>
  summarize(Count = n(), .groups = "drop")  

mosaic_table <- xtabs(Count ~ Location + Behavior, data = behavior_location)

colors <- paletteer_d("ggthemes::Miller_Stone")
highlighting_colors <- tail(colors, 5)

# Apply the colors to the mosaic plot
vcd::mosaic(
  ~ Behavior + Location,
  data = mosaic_table,
  direction = c("h", "v"),
  highlighting = "Behavior",
  highlighting_fill = highlighting_colors, # Using the last five colors
  shade = TRUE,
  legend = FALSE,
  main = "Mosaic of Behaviors by Location"
)
```

### How do Eastern Gray squirrels interact with humans when being sighted?

```{r fig.width= 10}
bubble_data <- squirrel_data |>
  select(X, Y, Eating, Foraging, Approaches, Runs.from) |>
  pivot_longer(
    cols = c(Eating, Foraging),
    names_to = "Behavior",
    values_to = "Observed_Behavior"
  ) |>
  pivot_longer(
    cols = c(Approaches, Runs.from),
    names_to = "Interaction",
    values_to = "Observed_Interaction"
  ) |>
  filter(Observed_Behavior == "true" & Observed_Interaction == "true") |>
  group_by(X, Y, Behavior, Interaction) |>
  summarize(Count = n(), .groups = "drop") |>
  st_as_sf(coords = c("X", "Y"), crs = 4326)

# Plotting using geom_sf
ggplot() +
  geom_sf(data = bubble_data, aes(color = Interaction), size = 3, shape = 1, alpha = 1) +
  facet_wrap(~Behavior) +
  labs(
    title = "Frequency of Human Interactions by Behavior and Location",
    size = "Interaction Count",
    color = "Behavior"
  ) +
  theme_minimal(base_size = 14) +
  scale_color_brewer(palette = "Set1")


```

```{r fig.height = 9, fig.width = 9}
sound_interaction <- squirrel_data |>
  select(Kuks, Quaas, Moans, Location, Approaches, Indifferent, Runs.from) |>
  pivot_longer(
    cols = c(Approaches, Indifferent, Runs.from),
    names_to = "Interaction",
    values_to = "Observed_Interaction"
  ) |>
  pivot_longer(
    cols = c(Kuks, Quaas, Moans),
    names_to = "Sound",
    values_to = "Sound_Value"
  ) |>
  filter(Sound_Value == "true", Observed_Interaction == "true") |>
  drop_na(Interaction, Sound) |>
  group_by(Location, Interaction, Sound) |>
  summarize(Freq = n(), .groups = "drop")

ggplot(sound_interaction,
       aes(axis1 = Location, axis2 = Sound, axis3 = Interaction, y = Freq, fill = Sound)) +
  geom_alluvium(color = "black") +
  geom_stratum() +
  geom_text(stat = "stratum", aes(label = after_stat(stratum))) +
  labs(
    title = "Transition of Human Interactions Across location and sound",
    x = "Categories",
    y = "Count of Observed Behaviors"
  ) +
  theme_minimal() +
  scale_fill_brewer(palette = "Set3")
```

```{r}
# coord_sf <- squirrel_data |>
#   st_as_sf(coords = c('X', 'Y'), crs = 4326) |>
#   pivot_longer(
#     cols = c(Running, Chasing, Climbing, Eating, Foraging), 
#     names_to = "Behavior",
#     values_to = "Observed"
#   ) |>
#   filter(Observed == "true") 
#   # No group_by needed if not summarizing
# 
# ggplot() + 
#   geom_sf(data = coord_sf, aes(color = Primary.Fur.Color), 
#           size = 1.5, shape = 1, alpha = 0.7) + 
#   scale_color_manual(values = c('black', '#D2691E', 'grey')) + 
#   facet_wrap(~ Behavior) +
#   theme_minimal() +
#   labs(title = 'Squirrel Sighting Locations by Color')
# 
# behavior_data <- squirrel_data |>
#   select(Age, Shift, Running, Chasing, Climbing, Eating, Foraging) |>
#   pivot_longer(
#     cols = c(Running, Chasing, Climbing, Eating, Foraging),
#     names_to = "Behavior",
#     values_to = "Observed"
#   ) |>
#   filter(Observed == "true") |>
#   group_by(Shift, Age, Behavior) |>
#   summarize(Count = n(), .groups = "drop")
```