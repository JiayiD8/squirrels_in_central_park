# Results

```{r, message=FALSE, warning=FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(tidyverse)
library(ggridges)
library(lubridate)

squirrel_data <- read.csv("./2018_Central_Park_Squirrel_Census_-_Squirrel_Data_20241120.csv")
squirrel_data <- squirrel_data |>
  mutate(across(everything(), ~ na_if(as.character(.), ""))) |>
  drop_na(Age, Location, Primary.Fur.Color) |>
  filter(Age != "?")
```

```{r}
# hectare_grid <- expand.grid(
#   north_south = 1:42,    # Numerical axis (1-42)
#   east_west = LETTERS[1:9]  # Roman letters (A-I)
# )
# 
# hectare_grid <- hectare_grid |>
#   mutate(
#     Hectare = paste0(east_west, north_south),  
#     lon = north_south,                        #
#     lat = match(east_west, LETTERS[1:9])     
#   )
# 
# squirrel_locations <- squirrel_data |>
#   filter(!is.na(Hectare)) |>  # Ensure we only use rows with Hectare information
#   mutate(
#     lon = as.numeric(substr(Hectare, 2, nchar(Hectare))),  
#     lat = match(substr(Hectare, 1, 1), LETTERS[1:9])      
#   )
# 
# ggplot() +
#   geom_tile(
#     data = hectare_grid,
#     aes(x = lon, y = lat, fill = "Grid"),
#     color = "black",
#     alpha = 0.1
#   ) +
#   # Add squirrel sightings as points
#   geom_point(
#     data = squirrel_locations,
#     aes(x = lon, y = lat, color = Primary.Fur.Color),
#     size = 2,
#     alpha = 0.7
#   ) +
#   scale_color_manual(values = c("gray" = "gray", "black" = "black", "cinnamon" = "brown")) +
#   labs(
#     title = "Squirrel Sightings by Hectare",
#     x = "Simulated Longitude",
#     y = "Simulated Latitude",
#     color = "Primary Fur Color"
#   ) +
#   theme_minimal() +
#   theme(legend.position = "bottom")
```



```{r fig.width=10, fig.height=8}
library(sf)
x_sf <- squirrel_data |>
mutate(Foraging = if_else(Foraging == TRUE, 
                      'Foraging',
                         if_else(Foraging == FALSE, 
                                'Not Foraging', 'Other'))) |>
mutate(Running = if_else(Running == TRUE, 
                      'Running',
                         if_else(Running == FALSE, 
                                'Not Running', 'Other'))) |>
  st_as_sf(coords = c('X', 'Y'), crs = 4326) 

  ggplot() + 
    geom_sf(data = x_sf, aes(colour = squirrel_data$Primary.Fur.Color), size = 1.5, shape = 1, alpha = .7) + 
scale_colour_manual(values = c('black', 'brown','grey', 'white')) + 
theme_minimal()  +
labs(title = 'Squirrel Sighting Locations by Colour')
```

```{r}
# Convert the Date column to proper date format
squirrel_data <- squirrel_data %>%
  mutate(
    Date = as.Date(Date, format = "%m%d%Y"),
    # Make Shift a factor with PM first so AM appears on top
    Shift = factor(Shift, levels = c("PM", "AM"))
  )

# Create the ridgeline plot
ggplot(squirrel_data, aes(x = Date, y = Shift, fill = Shift)) +
  geom_density_ridges(
    alpha = 0.6,
    scale = 0.9,
    rel_min_height = 0.01
  ) +
  scale_fill_manual(
    values = c("AM" = "#FDB462", "PM" = "#80B1D3")
  ) +
  scale_x_date(
    # Show every date on x-axis
    date_breaks = "1 day",
    date_labels = "%b %d",
    expand = c(0.01, 0) 
  ) +
  labs(
    title = "Distribution of Squirrel Sightings",
    subtitle = "By Time of Day",
    x = "Date",
    y = "Shift"
  ) +
  theme_ridges() +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  )
```


```{r}
behavior_data <- squirrel_data |>
  select(Age, Running, Chasing, Climbing, Eating, Foraging, Shift) |>
  pivot_longer(
    cols = c(Running, Chasing, Climbing, Eating, Foraging),
    names_to = "Behavior",
    values_to = "Observed"
  ) |>
  filter(Observed == "true") |>
  group_by(Age, Behavior, Shift) |>
  summarize(Count = n(), .groups = "drop")
```


```{r}
ggplot(behavior_data, aes(x = Behavior, y = Count, fill = Age)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Comparison of Behaviors by Age and Shift",
    x = "Behavior",
    y = "Count of Squirrels",
    fill = "Age Group"
  ) +
  facet_wrap(~Shift) +
  theme_minimal() +
  scale_fill_brewer(palette = "Blues", direction = -1)

```

```{r}
# library(plotly)
# behavior_data <- squirrel_data |>
#   select(Shift, Running, Chasing, Climbing, Eating, Foraging) |>
#   pivot_longer(
#     cols = c(Running, Chasing, Climbing, Eating, Foraging),
#     names_to = "Behavior",
#     values_to = "Observed"
#   ) |>
#   filter(Observed == "true") |>
#   group_by(Shift, Behavior) |>
#   summarize(Count = n(), .groups = "drop") |>
#   mutate(Proportion = Count / sum(Count))  
#
# sunburst_data <- behavior_data |>
#   mutate(
#     ids = paste(Shift, Behavior, sep = "-"),  # unique ID for each slice
#     labels = Behavior,
#     parents = Shift  # parent category for each behavior
#   )
#
# plot_ly(
#   sunburst_data,
#   labels = ~labels,
#   parents = ~parents,
#   values = ~Proportion,
#   type = 'sunburst',
#   branchvalues = 'total'
# ) %>%
#   layout(
#     title = list(
#       text = "Proportion of Behaviors by Shift",
#       font = list(size = 20)
#     ),
#     colorway = RColorBrewer::brewer.pal(8, "Set2")  
#   )

```

```{r}
library(ggalluvial)
behavior_data <- squirrel_data |>
  select(Age, Shift, Running, Chasing, Climbing, Eating, Foraging) |>
  pivot_longer(
    cols = c(Running, Chasing, Climbing, Eating, Foraging),
    names_to = "Behavior",
    values_to = "Observed"
  ) |>
  filter(Observed == "true") |>
  group_by(Shift, Age, Behavior) |>
  summarize(Count = n(), .groups = "drop")  

ggplot(behavior_data,
       aes(axis1 = Age, axis2 = Shift, y = Count, fill = Behavior)) +
  geom_alluvium(aes(fill = Behavior)) +
  geom_stratum() +
  geom_text(stat = "stratum", aes(label = after_stat(stratum))) +
  labs(
    title = "Transition of Behaviors Across Shift and Age",
    x = "Categories",
    y = "Count of Observed Behaviors"
  ) +
  theme_minimal() +
  scale_fill_brewer(palette = "Set3")

```

```{r}
library(viridis)
library(scico)
behavior_location <- squirrel_data |>
  select(Running, Chasing, Climbing, Eating, Foraging, Location) |>
  pivot_longer(
    cols = c(Running, Chasing, Climbing, Eating, Foraging),
    names_to = "Behavior",
    values_to = "Observed"
  ) |>
  filter(Observed == "true") |>
  group_by(Behavior, Location) |>
  summarize(Count = n(), .groups = "drop")  

mosaic_table <- xtabs(Count ~ Location + Behavior, data = behavior_location)

vcd::mosaic(
  ~ Behavior + Location,
  data = mosaic_table,
  direction = c("h", "v"),
  highlighting = "Behavior",
  highlighting_fill = scico(5, palette = "lajolla"), # Using the La Jolla palette
  shade = TRUE,
  legend = FALSE,
  main = "Mosaic of Behaviors by Location"
)
```


```{r}
interaction_data <- squirrel_data |>
  select(Running, Climbing, Eating, Foraging, Approaches, Runs.from) |>
  pivot_longer(
    cols = c(Running, Climbing, Eating, Foraging),
    names_to = "Behavior",
    values_to = "Observed_Behavior"
  ) |>
  pivot_longer(
    cols = c(Approaches, Runs.from),
    names_to = "Interaction",
    values_to = "Observed_Interaction"
  ) |>
  filter(Observed_Behavior == "true" & Observed_Interaction == "true") |>
  group_by(Behavior, Interaction) |>
  summarize(Count = n(), .groups = "drop")

ggplot(interaction_data,
       aes(axis1 = Behavior, axis2 = Interaction, y = Count, fill = Behavior)) +
  geom_alluvium() +
  geom_stratum() +
  geom_text(stat = "stratum", aes(label = after_stat(stratum))) +
  labs(
    title = "Behaviors and Human Interactions",
    x = "Categories",
    y = "Count of Observed Behaviors",
    fill = "Behavior"
  ) +
  theme_minimal(base_size = 14) +
  scale_fill_viridis_d()

```

```{r fig.width= 10}
bubble_data <- squirrel_data |>
  select(X, Y, Eating, Foraging, Approaches, Runs.from) |>
  pivot_longer(
    cols = c(Eating, Foraging),
    names_to = "Behavior",
    values_to = "Observed_Behavior"
  ) |>
  pivot_longer(
    cols = c(Approaches, Runs.from),
    names_to = "Interaction",
    values_to = "Observed_Interaction"
  ) |>
  filter(Observed_Behavior == "true" & Observed_Interaction == "true") |>
  group_by(X, Y, Behavior, Interaction) |>
  summarize(Count = n(), .groups = "drop")

ggplot(bubble_data, aes(x = X, y = Y, size = Count, color = Behavior), shape = 1) +
  geom_point(alpha = 0.7) +
  facet_wrap(~Interaction) +
  labs(
    title = "Frequency of Human Interactions by Behavior and Location",
    x = "Longitude (X)",
    y = "Latitude (Y)",
    size = "Interaction Count",
    color = "Behavior"
  ) +
  theme_minimal(base_size = 14) +
  scale_color_brewer(palette = "Set3")

```

```{r fig.height = 9, fig.width = 9}
sound_interaction <- squirrel_data |>
  select(Kuks, Quaas, Moans, Location, Approaches, Indifferent, Runs.from) |>
  pivot_longer(
    cols = c(Approaches, Indifferent, Runs.from),
    names_to = "Interaction",
    values_to = "Observed_Interaction"
  ) |>
  pivot_longer(
    cols = c(Kuks, Quaas, Moans),
    names_to = "Sound",
    values_to = "Sound_Value"
  ) |>
  filter(Sound_Value == "true", Observed_Interaction == "true") |>
  drop_na(Interaction, Sound) |>    # Corrected spelling here
  group_by(Location, Interaction, Sound) |>
  summarize(Freq = n(), .groups = "drop")

ggplot(sound_interaction,
       aes(axis1 = Location, axis2 = Sound, axis3 = Interaction, y = Freq, fill = Sound)) +
  geom_alluvium(color = "black") +
  geom_stratum() +
  geom_text(stat = "stratum", aes(label = after_stat(stratum))) +
  labs(
    title = "Transition of Human Interactions Across location and sound",
    x = "Categories",
    y = "Count of Observed Behaviors"
  ) +
  theme_minimal() +
  scale_fill_brewer(palette = "Set3")
```

